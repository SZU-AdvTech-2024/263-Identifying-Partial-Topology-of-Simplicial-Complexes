clc;
clear;
close all;
global A1 A21 A22 m1 m2 d theta o1 o2 A23 A24 A25 A26 A27 A28 A29 A210;
A1=[-5,1,1,1,1,0,0,1,0,0;
     1,-4,1,1,0,0,0,1,0,0;
     1,1,-5,1,0,0,1,0,1,0;
     1,1,1,-6,1,0,1,0,1,0;
     1,0,0,1,-5,1,0,1,0,1;
     0,0,0,0,1,-3,1,0,1,0;
     0,0,1,1,0,1,-4,0,0,1;
     1,1,0,0,1,0,0,-5,1,1;
     0,0,1,1,0,1,0,1,-5,1;
     0,0,0,0,1,0,1,1,1,-4];
A21=[-12,0,0,0,0,0,0,0,0,0;
       0,0,1,1,0,0,0,1,0,0;
       0,1,0,1,0,0,0,0,0,0;
       0,1,1,0,1,0,0,0,0,0;
       0,0,0,1,0,0,0,1,0,0;
       0,0,0,0,0,0,0,0,0,0;
       0,0,0,0,0,0,0,0,0,0;
       0,1,0,0,1,0,0,0,0,0;
       0,0,0,0,0,0,0,0,0,0;
       0,0,0,0,0,0,0,0,0,0];
A22=[0,0,1,1,0,0,0,1,0,0;
     0,-8,0,0,0,0,0,0,0,0;
     1,0,0,1,0,0,0,0,0,0;
     1,0,1,0,0,0,0,0,0,0;
     0,0,0,0,0,0,0,0,0,0;
     0,0,0,0,0,0,0,0,0,0;
     0,0,0,0,0,0,0,0,0,0;
     1,0,0,0,0,0,0,0,0,0;
     0,0,0,0,0,0,0,0,0,0;
     0,0,0,0,0,0,0,0,0,0];
A23=[0,1,0,1,0,0,0,0,0,0;
    1,0,0,0,0,0,0,0,0,0;
    0,0,-8,0,0,0,0,0,0,0;
    1,0,0,0,0,0,1,0,1,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,1,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,1,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0];
A24=[0,0,1,0,1,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    1,0,0,0,0,0,1,0,1,0;
    0,0,0,-8,0,0,0,0,0,0;
    1,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,1,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,1,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0];
A25=[0,0,0,1,0,0,0,1,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    1,0,0,0,0,0,0,0,0,0;
    0,0,0,0,-6,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    1,0,0,0,0,0,0,0,0,1;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,1,0,0];
A26=[0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0];
A27=[0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,1,0,0,0,0,0,0;
    0,0,1,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,-2,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0];
A28=[0,0,0,0,1,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    1,0,0,0,0,0,0,0,0,1;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,-6,0,0;
    0,0,0,0,0,0,0,0,0,1;
    0,0,0,0,1,0,0,0,1,0];
A29=[0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,1,0,0,0,0,0,0;
    0,0,1,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,1;
    0,0,0,0,0,0,0,0,-4,0;
    0,0,0,0,0,0,0,1,0,0];
A210=[0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,1,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,0;
    0,0,0,0,1,0,0,0,1,0;
    0,0,0,0,0,0,0,1,0,0;
    0,0,0,0,0,0,0,0,0,-4];
m1=50;m2=0.01;d=1;theta=1;
o1=0.1;o2=0.1;%耦合强度
arr_o1=[0.1,0.1,0.1,0.1,1,2,4];
arr_o2=[4,2,1,0.1,0.1,0.1,0.1];
arr_a=[0,0.2,0.4,0.6,0.8,1];

x=zeros(10,3);
for i=1:10
    x(i,:)=[3*i-2,3*i-1,3*i];
end
x=x';
x=x(:);
y=zeros(2,3);
for i=1:2
    y(i,:)=[3*i+28,3*i+29,3*i+30];
end
y=y';
y=y(:);
k=zeros(2,1);
a1=zeros(20,1);
a21=zeros(100,1);
a22=zeros(100,1);
x0=cat(1,x,y,k,a1,a21,a22);
space=0.001;
tspan=[0,1000];
data=zeros(7,1000001,258);

figure;
for test=1:7
tic;
o1=arr_o1(test);
o2=arr_o2(test);
[t,x]=ode45(@fun,tspan(1):space:tspan(2),x0);
toc;
data(test,1:tspan(2)*1000+1,:)=x;
Ep2=0;
for i=1:10
    for j=1:10
        Ep2=Ep2+abs(x(:,58+10*i+j-10)-A21(i,j))+abs(x(:,158+10*i+j-10)-A22(i,j));
    end
end
Ep2=Ep2/200;
subplot(2,1,1);
title('Ep2');
hold on;
plot(t,Ep2),legend('o1=0.1 o2=4','o1=0.1 o2=2','o1=0.1 o2=1','o1=0.1 o2=0.1','o1=1 o2=0.1','o1=2 o2=0.1','o1=4 o2=0.1');
hold off;
Ep1=0;
for i=1:2
    for j=1:10
        Ep1=Ep1+abs(x(:,38+10*i-10+j)-A1(i,j));
    end
end
Ep1=Ep1/20;
subplot(2,1,2);
title('Ep1');
hold on;
plot(t,Ep1),legend('o1=0.1 o2=4','o1=0.1 o2=2','o1=0.1 o2=1','o1=0.1 o2=0.1','o1=1 o2=0.1','o1=2 o2=0.1','o1=4 o2=0.1');
hold off;
end

figure;
for test=1:6
tic;
o1=0.1;
o2=0.1;
theta=arr_a(test);
[t,x]=ode45(@fun,tspan(1):space:tspan(2),x0);
toc;
Ep2=0;
for i=1:10
    for j=1:10
        Ep2=Ep2+abs(x(:,58+10*i+j-10)-A21(i,j))+abs(x(:,158+10*i+j-10)-A22(i,j));
    end
end
Ep2=Ep2/200;
subplot(2,1,1);
title('Ep2');
hold on;
plot(t,Ep2),legend('a=0','a=0.2','a=0.4','a=0.6','a=0.8','a=1');
hold off;
Ep1=0;
for i=1:2
    for j=1:10
        Ep1=Ep1+abs(x(:,38+10*i-10+j)-A1(i,j));
    end
end
Ep1=Ep1/20;
subplot(2,1,2);
title('Ep1');
hold on;
plot(t,Ep1),legend('a=0','a=0.2','a=0.4','a=0.6','a=0.8','a=1');
hold off;
end

function dx=fun(t,x)
    X=x(1:30);
    Y=x(31:36);
    k2=x(37:38);
    a1=x(39:58);
    a21=x(59:158);
    a22=x(159:258);
    e=Y-X(1:6);
    dx=zeros(258,1);
   global A1 A21 A22 m1 m2 d theta o1 o2 A23 A24 A25 A26 A27 A28 A29 A210;
    %驱动层
    for i=1:10
        fi=[(25*theta+10)*(X(3*i-1)-X(3*i-2));(28-35*theta)*X(3*i-2)-X(3*i-2)*X(3*i)+(29*theta-1)*X(3*i-1);X(3*i-2)*X(3*i-1)-1/3*(theta+8)*X(3*i)];
        result=0;
        result1=0;
        for j=1:10
            result=result+o1*A1(i,j)*[X(3*j-2);0;0];
            for k=1:10
                 if(i==1)
                    result1=result1+o2*A21(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                elseif(i==2)
                    result1=result1+o2*A22(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                elseif(i==3)
                    result1=result1+o2*A23(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                elseif(i==4)
                    result1=result1+o2*A24(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                elseif(i==5)
                    result1=result1+o2*A25(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                elseif(i==6)
                    result1=result1+o2*A26(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                elseif(i==7)
                    result1=result1+o2*A27(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]); 
                elseif(i==8)
                    result1=result1+o2*A28(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                elseif(i==9)
                    result1=result1+o2*A29(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                elseif(i==10)
                    result1=result1+o2*A210(j,k)*([X(3*j-2)^2*X(3*k-2);0;0]);
                end
            end   
        end
        dx(3*i-2:3*i)=fi+result+result1;
    end
    %响应层
    for i=1:2
        fi=[(25*theta+10)*(Y(3*i-1)-Y(3*i-2));(28-35*theta)*Y(3*i-2)-Y(3*i-2)*Y(3*i)+(29*theta-1)*Y(3*i-1);Y(3*i-2)*Y(3*i-1)-1/3*(theta+8)*Y(3*i)];
        result=0;
        result1=0;
        for j=1:2
            result=result+o1*a1(10*i+j-10)*[Y(3*j-2);0;0];
            for k=1:2
                if(i==1)
                    result1=result1+o2*a21(10*j+k-10)*[Y(3*j-2)^2*Y(3*k-2);0;0];
                elseif(i==2)
                    result1=result1+o2*a22(10*j+k-10)*[Y(3*j-2)^2*Y(3*k-2);0;0];  
                end
            end
             for k=3:10
                if(i==1)
                    result1=result1+o2*a21(10*j+k-10)*[Y(3*j-2)^2*X(3*k-2);0;0];
                elseif(i==2)
                    result1=result1+o2*a22(10*j+k-10)*[Y(3*j-2)^2*X(3*k-2);0;0];  
                end
            end
        end
        for j=3:10
            result=result+o1*a1(10*i+j-10)*[X(3*j-2);0;0];
            for k=1:2
                if(i==1)
                    result1=result1+o2*a21(10*j+k-10)*[X(3*j-2)^2*Y(3*k-2);0;0];
                elseif(i==2)
                    result1=result1+o2*a22(10*j+k-10)*[X(3*j-2)^2*Y(3*k-2);0;0];  
                end
            end
            for k=3:10
                if(i==1)
                    result1=result1+o2*a21(10*j+k-10)*[X(3*j-2)^2*X(3*k-2);0;0];
                elseif(i==2)
                    result1=result1+o2*a22(10*j+k-10)*[X(3*j-2)^2*X(3*k-2);0;0];  
                end
            end
        end
        dx(3*i-2+30:3*i+30)=fi+result+result1-k2(i)*(e(3*i-2:3*i));
     end
     %k值
     for i=1:2
         dx(36+i)=d*(e(3*i-2:3*i))'*(e(3*i-2:3*i));
     end
     
     for i=1:2   
        for j=1:2
            dx(38+10*i-10+j)=-m1*(e(3*i-2:3*i))'*[Y(3*j-2);0;0];
        end
        for j=3:10
            dx(38+10*i-10+j)=-m1*(e(3*i-2:3*i))'*[X(3*j-2);0;0];
        end
     end

     for i=1
        for j=1:2
            for k=1:2
                dx(58+10*j-10+k)=-m2*(e(3*i-2:3*i))'*[Y(3*j-2)^2*Y(3*k-2);0;0];
            end
            for k=3:10
                dx(58+10*j-10+k)=-m2*(e(3*i-2:3*i))'*[Y(3*j-2)^2*X(3*k-2);0;0];
            end
        end   
        for j=3:10
            for k=1:2
                dx(58+10*j-10+k)=-m2*(e(3*i-2:3*i))'*[X(3*j-2)^2*Y(3*k-2);0;0];
            end
            for k=3:10
                dx(58+10*j-10+k)=-m2*(e(3*i-2:3*i))'*[X(3*j-2)^2*X(3*k-2);0;0];
            end
        end  
    end

    for i=2
        for j=1:2
            for k=1:2
                dx(158+10*j-10+k)=-m2*(e(3*i-2:3*i))'*[Y(3*j-2)^2*Y(3*k-2);0;0];
            end
            for k=3:10
                dx(158+10*j-10+k)=-m2*(e(3*i-2:3*i))'*[Y(3*j-2)^2*X(3*k-2);0;0];
            end
        end   
        for j=3:10
            for k=1:2
                dx(158+10*j-10+k)=-m2*(e(3*i-2:3*i))'*[X(3*j-2)^2*Y(3*k-2);0;0];
            end
            for k=3:10
                dx(158+10*j-10+k)=-m2*(e(3*i-2:3*i))'*[X(3*j-2)^2*X(3*k-2);0;0];
            end
        end 
    end
end
